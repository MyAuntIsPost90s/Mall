<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>商品页面</title>

    <link href="Contents/lib/AmazeUI-2.4.2/assets/css/admin.css" rel="stylesheet" type="text/css"/>
    <link href="Contents/lib/AmazeUI-2.4.2/assets/css/amazeui.css" rel="stylesheet" type="text/css"/>
    <link href="Contents/lib/basic/css/demo.css" rel="stylesheet" type="text/css"/>
    <link type="text/css" href="Contents/css/optstyle.css" rel="stylesheet"/>
    <link type="text/css" href="Contents/css/style.css" rel="stylesheet"/>
    <link href="Contents/css/hmstyle.css" rel="stylesheet" type="text/css"/>

    <script src="Contents/js/jquery.min.js"></script>
    <script src="Contents/js/config.js"></script>
    <script src="Contents/lib/lingshiframework/lingshi_base.js"></script>
    <script type="text/javascript" src="Contents/lib/AmazeUI-2.4.2/assets/js/amazeui.js"></script>
    <script type="text/javascript" src="Contents/js/jquery.imagezoom.min.js"></script>
    <script type="text/javascript" src="Contents/js/jquery.flexslider.js"></script>
    <style type="text/css">
        #nav {
            display: none;
        }

        .line {
            margin-top: 10px;
        }
    </style>
</head>

<body>
<!--顶部导航条 -->
<div id="ctrl-header-nav"></div>

<!--悬浮搜索框-->
<div class="nav white">
    <div class="logo"><img src="Contents/images/logo.png"/></div>
    <div class="logoBig">
        <li><img src="Contents/images/logobig.png"/></li>
    </div>

    <div class="search-bar pr">
        <a name="index_none_header_sysc" href="#"></a>
        <form id="form-search" action="search.html">
            <input id="inp-goodskindid" name="goodskindid" type="hidden" value=""/>
            <input id="searchInput" name="goodsname" type="text" placeholder="搜索" autocomplete="off">
            <input id="ai-topsearch" class="submit am-btn" value="搜索" index="1" type="submit">
        </form>
    </div>
</div>

<div class="clear"></div>
<b class="line"></b>
<div class="listMain">

    <!-- 物品分类组件 -->
    <div id="div-nav-goodskind"></div>
    <ol class="am-breadcrumb am-breadcrumb-slash">
        <li><a href="home.html">首页</a></li>
        <li><a id="a-goodskind" href="search.html">分类</a></li>
        <li class="am-active">详情</li>
    </ol>
    <script type="text/javascript">
        $(function () {
        });
        $(window).load(function () {
            $('.flexslider').flexslider({
                animation: "slide",
                start: function (slider) {
                    $('body').removeClass('loading');
                }
            });
        });
    </script>
    <div class="scoll">
        <section class="slider">
            <div class="flexslider">
                <ul id="ul-bigimg" class="slides">

                </ul>
            </div>
        </section>
    </div>

    <!--放大镜-->

    <div class="item-inform">
        <div class="clearfixLeft" id="clearcontent">

            <div class="box">


                <div class="tb-booth tb-pic tb-s310">
                    <a href="Contents/images/01.jpg"><img src="Contents/images/01_mid.jpg" alt="细节展示放大镜特效"
                                                          rel="Contents/images/01.jpg"
                                                          class="jqzoom"/></a>
                </div>
                <ul id="ul-minimg" class="tb-thumb">

                </ul>
            </div>

            <div class="clear"></div>
        </div>

        <div class="clearfixRight">

            <!--规格属性-->
            <!--名称-->
            <div class="tb-detail-hd">
                <h1 id="h1-goodsname">
                    良品铺子 手剥松子218g 坚果炒货 巴西松子
                </h1>
            </div>
            <div class="tb-detail-list">
                <!--价格-->
                <div class="tb-detail-price">
                    <li class="price iteminfo_price">
                        <dt>促销价</dt>
                        <dd><em>¥</em><b id="b-goodsprice" class="sys_item_price">56.90</b></dd>
                    </li>
                    <div class="clear"></div>
                </div>
                <div class="clear"></div>
                <!--活动	-->
                <div class="shopPromotion gold">
                    <div class="hot">
                        <dt class="tb-metatit">商城优惠</dt>
                        <div class="gold-list">
                            <p>购物满2件打8折，满3件7折</p>
                        </div>
                    </div>
                    <div class="clear"></div>
                    <div class="coupon">
                        <dt class="tb-metatit">优惠券</dt>
                        <div class="gold-list">
                            <ul>
                                <li>125减5</li>
                                <li>198减10</li>
                                <li>298减20</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!--各种规格-->
            <dl class="iteminfo_parameter sys_item_specpara">
                <dt class="theme-login">
                    <div class="cart-title">可选规格<span class="am-icon-angle-right"></span></div>
                </dt>
                <dd>
                    <!--操作页面-->
                    <div class="theme-popover-mask"></div>
                    <div class="theme-popover">
                        <div class="theme-span"></div>
                        <div class="theme-poptit">
                            <a href="javascript:;" title="关闭" class="close">×</a>
                        </div>
                        <div class="theme-popbod dform">
                            <form class="theme-signin" name="loginform" action="" method="post">
                                <div class="theme-signin-left">
                                    <div class="theme-options">
                                        <div class="cart-title number">数量</div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </dd>
                <dd>
                    <input id="inp-sub" class="am-btn am-btn-default" name="" type="button" value="-"/>
                    <input id="inp-goodscount" min="1" name="" type="number" value="1" style="width:50px;"/>
                    <input id="inp-add" class="am-btn am-btn-default" name="" type="button" value="+"/>
                    <span class="tb-hidden">库存<span id="span-goodscount" class="stock">1000</span>件</span>
                    <div class="pay">
                        <div class="pay-opt">
                            <a href="home.html"><span class="am-icon-home am-icon-fw">首页</span></a>
                            <a><span class="am-icon-heart am-icon-fw">收藏</span></a>
                        </div>
                        <li>
                            <div class="clearfix tb-btn tb-btn-buy theme-login">
                                <a id="LikBuy" title="点此按钮到下一步确认购买信息">立即购买</a>
                            </div>
                        </li>
                        <li>
                            <div class="clearfix tb-btn tb-btn-basket theme-login">
                                <a id="LikBasket" title="加入购物车"><i></i>加入购物车</a>
                            </div>
                        </li>
                    </div>
                </dd>
            </dl>
        </div>
        <div class="clear"></div>

        <div class="btn-op">
            <div class="btn am-btn am-btn-warning">确认</div>
            <div class="btn close am-btn am-btn-warning">取消</div>
        </div>
    </div>
    <div class="theme-signin-right">
        <div class="img-info">
            <img src="Contents/images/songzi.jpg"/>
        </div>
        <div class="text-info">
            <span class="J_Price price-now">¥39.00</span>
            <span id="Stock" class="tb-hidden">库存<span class="stock">1000</span>件</span>
        </div>
    </div>

    </form>
</div>
</div>

<div class="clear"></div>

<!-- introduce-->
<div class="introduce">
    <div class="browse">
        <div class="mc">
            <ul id="ul-newGoods">
                <div class="mt">
                    <h2>最新上市</h2>
                </div>
            </ul>
        </div>
    </div>
    <div class="introduceMain">
        <div class="am-tabs" data-am-tabs>
            <ul class="am-avg-sm-3 am-tabs-nav am-nav am-nav-tabs">
                <li class="am-active">
                    <a href="#">
                        <span class="index-needs-dt-txt">宝贝详情</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="index-needs-dt-txt">猜你喜欢</span>
                    </a>
                </li>
            </ul>

            <div class="am-tabs-bd">
                <div id="div-goodscontent" class="am-tab-panel am-fade am-in am-active"></div>
                <div class="am-tab-panel am-fade">
                    <div class="like">
                        <ul id="ul-relaGoods" class="am-avg-sm-2 am-avg-md-3 am-avg-lg-4 boxes">

                        </ul>
                    </div>
                    <div class="clear"></div>
                </div>
            </div>

        </div>

        <div class="clear"></div>

        <div class="footer">
            <div class="footer-hd">
                <p>
                    <a href="#">恒望科技</a>
                    <b>|</b>
                    <a href="#">商城首页</a>
                    <b>|</b>
                    <a href="#">支付宝</a>
                    <b>|</b>
                    <a href="#">物流</a>
                </p>
            </div>
            <div class="footer-bd">
                <p>
                    <a href="#">关于恒望</a>
                    <a href="#">合作伙伴</a>
                    <a href="#">联系我们</a>
                    <a href="#">网站地图</a>
                    <em>© 备个鬼案</em>
                </p>
            </div>
        </div>
    </div>

</div>
</div>
<!--菜单 -->
<div id="ctrl-menu"></div>

<script id="lay-minimg" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <li class="tb-selected">
        <div class="tb-pic tb-s40">
            <a>
                <img src="{{ Config.UrlHead + item.goodsimgurl }}" mid="{{ Config.UrlHead + item.goodsimgurl }}"
                     big="{{ Config.UrlHead + item.goodsimgurl }}">
            </a>
        </div>
    </li>
    {{# }) }}
</script>
<script id="lay-bigimg" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <li>
        <img src="{{ Config.UrlHead + item.goodsimgurl }}" title="pic"/>
    </li>
    {{# }) }}
</script>
<script id="lay-newGoods" type="text/html">
    {{#  layui.each(d.rows, function(index, item){ }}
    <li>
        <div class="p-img">
            <a href="introduction.html?goodsid={{ item.goodsid }}">
                <img src="{{ item.goodsimgurl==''?'Contents/images/imgsearch1.jpg':(Config.UrlHead + item.goodsimgurl) }}"
                     width="194" height="194"/>
            </a>
        </div>
        <div class="p-name">{{ item.goodsname }}</div>
        <div class="p-price">
            <b>¥</b>
            <strong>{{ item.goodsprice }}</strong>
        </div>
    </li>
    {{# }) }}
</script>
<script id="lay-relaGoods" type="text/html">
    {{#  layui.each(d.rows, function(index, item){ }}
    <li>
        <div class="i-pic limit">
            <a href="introduction.html?goodsid={{ item.goodsid }}">
                <img src="{{ item.goodsimgurl==''?'Contents/images/imgsearch1.jpg':(Config.UrlHead + item.goodsimgurl) }}"
                     width="218" height="218"/>
            </a>
            <p>{{ item.goodsname }}</p>
            <p class="price fl">
                <b>¥</b>
                <strong>{{ item.goodsprice }}</strong>
            </p>
        </div>
    </li>
    {{# }) }}
</script>
<script src="Contents/js/mall.dao.js"></script>
<script src="Contents/lib/layui/layui.all.js"></script>
<script src="Contents/js/mall.service.js"></script>
</body>
<script>
    //商品详情
    function IntroductionService() {
        var headerService = new HeaderService();
        var menuService = new MenuService();
        var barService = new GoodsKindBarService();
        var logined = false;
        var goodsid = null;

        this.init = function () {
            headerService.init();
            menuService.init();
            barService.init();

            goodsid = LingShiUtil.getParam("goodsid");
            if (goodsid == null || goodsid == '') {
                return;
            }
            webappDao.getIntroduction({goodsid: goodsid}, function (data) {
                if (data.code != 1) {
                    layer.msg(data.msg);
                    return;
                }
                console.log(data);
                logined = data.data.logined;
                loadGoods(data.data.goods);
                loadNewGoods(data.data.newGoods);
                loadRelaGoods(data.data.relateGoods);
                bindEvent();
            })
        }

        //加载物品详情
        function loadGoods(goods) {
            $('#a-goodskind').attr('href', 'search.html?goodskindid=' + goods.goodskindid);
            $('#a-goodskind').html(goods.goodskind.goodskindname);
            $('#h1-goodsname').html(goods.goodsname);
            $('#b-goodsprice').html(goods.goodsprice);
            $('#span-goodscount').html(goods.goodscount);
            $('#inp-goodscount').html(goods.goodscount);
            $('#inp-goodscount').attr('max', goods.goodscount);
            $('#div-goodscontent').html(goods.goodscontents);

            var temp = $('#lay-bigimg').html();
            layui.laytpl(temp).render(goods.goodsimgs, function (html) {
                $('#ul-bigimg').html(html);
            });
            temp = $('#lay-minimg').html();
            layui.laytpl(temp).render(goods.goodsimgs, function (html) {
                $('#ul-minimg').html(html);
            });

            $(".jqzoom").imagezoom();
            $("#ul-minimg li a").click(function () {
                $(this).parents("li").addClass("tb-selected").siblings().removeClass("tb-selected");
                $(".jqzoom").attr('src', $(this).find("img").attr("mid"));
                $(".jqzoom").attr('rel', $(this).find("img").attr("big"));
            });
            $("#ul-minimg li a").first().click();
        }

        //加载最新上市
        function loadNewGoods(list) {
            var temp = $('#lay-newGoods').html();
            layui.laytpl(temp).render(list, function (html) {
                $('#ul-newGoods').html(html);
            });
        }

        //加载相关商品
        function loadRelaGoods(list) {
            var temp = $('#lay-relaGoods').html();
            layui.laytpl(temp).render(list, function (html) {
                $('#ul-relaGoods').html(html);
            });
        }

        //添加进购物车
        function addToShopCart() {
            var shopcartDao = new ShopcartDao();
            var count = parseInt($('#inp-goodscount').val());
            shopcartDao.add({goodsid: goodsid, shopcartcount: count}
                , function (data) {
                    layer.msg(data.msg);
                    if(data.code==1){
                        headerService.reloadShopcart();
                        menuService.reloadShopcart();
                    }
                })
        }

        //绑定点击事件
        function bindEvent() {
            $('#inp-sub').click(function () {
                var mincount = 1;
                var count = parseInt($('#inp-goodscount').val());
                if (count <= mincount) {
                    return;
                }
                count--;
                $('#inp-goodscount').val(count)
            });
            $('#inp-add').click(function () {
                var maxcount = parseInt($('#inp-goodscount').attr('max'));
                var count = parseInt($('#inp-goodscount').val());
                if (count >= maxcount) {
                    return;
                }
                count++;
                $('#inp-goodscount').val(count)
            })

            $('#LikBuy').click(function () {
                if (!logined) {
                    headerService.toLogin();
                    return;
                }
                addToShopCart();    //加入购物车
                window.location.href='shopcart.html';   //跳转页面
            })
            $('#LikBasket').click(function () {
                if (!logined) {
                    headerService.toLogin();
                    return;
                }
                addToShopCart();    //加入购物车
            })
        }
    }

    var introductionService = null;
    $(function () {
        introductionService = new IntroductionService();
        introductionService.init();
    })
</script>
</html>